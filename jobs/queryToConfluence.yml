---
vars:
stub: "https://issues.apache.org/jira/rest/api/2"
headers:
  Content-Type: "application/json"
  Authorization: "basic"
auth:
  username:
  password: 
tasks:
  - name: "Authenticate"
    uri: "issue/createmeta"
    action: 
      req: "get"
  - name: "Query Tickets"
    uri: "search"
    data:
      jql: "project = INFRA AND labels = ReviewedByInfra"
      fields: [ "key" ]
    action: 
      req: "post"
    output: 
      type: "var"
      show: "content"
      name: "issues"
  - name: "Get page content"
    uri: "content/123899312?expand=body.storage"
    stub_override: "https://cwiki.apache.org/confluence/rest/api"
    action:
      req: "get"
    output:
      type: "var"
      show: "content"
      name: "page"
  - name: "Update Page Content"
    uri: "none"
    action: 
      dump: "<p><ac:structured-macro ac:name=\"jira\" ac:schema-version=\"1\" ac:macro-id=\"91a4e6cf-e974-40ef-9943-30fc350845e6\">
<ac:parameter ac:name=\"server\">ASF JIRA</ac:parameter>
<ac:parameter ac:name=\"columnIds\">issuekey,summary,issuetype,created,updated,duedate,assignee,reporter,priority,status,resolution</ac:parameter>
<ac:parameter ac:name=\"columns\">key,summary,type,created,updated,due,assignee,reporter,priority,status,resolution</ac:parameter>
<ac:parameter ac:name=\"serverId\">5aa69414-a9e9-3523-82ec-879b028fb15b</ac:parameter>
<ac:parameter ac:name=\"key\">{{ issue.key }}</ac:parameter>
</ac:structured-macro></p>"
    loop:
      items: "{{ issues.issues }}"
      iter_name: "issue"
  - name: "Show page"
    uri: "none"
    action:
      dump: "{{ page.body.storage.value }}"
verbose: True
